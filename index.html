<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow Events - Premium Hardstyle</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root { --shadow-red: #8b0000; --shadow-dark: #050505; --shadow-text: #b0b0b0; --verde: #2e7d32; }
        body { background: #000; color: var(--shadow-text); font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; }
        header { background: #000; padding: 20px; border-bottom: 2px solid var(--shadow-red); position: sticky; top: 0; z-index: 100; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .search-container { width: 100%; max-width: 500px; margin: 0 auto; display: flex; }
        .search-container input { flex: 1; padding: 12px; background: #111; border: 1px solid var(--shadow-red); color: white; border-radius: 5px; }
        
        .grid-eventos { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 40px; padding: 40px; max-width: 1200px; margin: auto; }
        .ticket-container { perspective: 1000px; height: 530px; }
        .ticket-3d { position: relative; width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 0.8s; }
        .ticket-container:hover .ticket-3d { transform: rotateY(180deg); }

        .front, .back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 15px; border: 2px solid var(--shadow-red); overflow: hidden; display: flex; flex-direction: column; }
        .front { background: #111; }
        .back { background: #0a0a0a; transform: rotateY(180deg); padding-bottom: 20px; }

        .ticket-img { height: 280px; background-size: cover; background-position: center; border-bottom: 1px solid #222; }
        .back-img { height: 180px; background-size: contain; background-repeat: no-repeat; background-position: center; margin: 15px; }
        
        /* Estilo para Stock y Ventas */
        .ticket-stats { display: flex; justify-content: space-around; padding: 10px; background: rgba(139, 0, 0, 0.2); font-size: 12px; color: white; border-bottom: 1px solid #222; }

        .chat-container { position: fixed; bottom: 0; left: 20px; width: 300px; background: #0d0d0d; border: 2px solid var(--shadow-red); z-index: 999; transition: 0.4s; transform: translateY(275px); border-radius: 10px 10px 0 0; }
        .chat-container.active { transform: translateY(0); }
        .chat-header { background: var(--shadow-red); padding: 12px; color: white; cursor: pointer; display: flex; justify-content: space-between; font-weight: bold; }
        #chat-display { height: 220px; overflow-y: auto; padding: 10px; font-size: 13px; background: #000; border-bottom: 1px solid #333; }

        #cart-sidebar { position: fixed; right: -400px; top: 0; width: 350px; height: 100%; background: #050505; border-left: 2px solid var(--shadow-red); transition: 0.4s; z-index: 1000; padding: 30px; }
        #cart-sidebar.active { right: 0; }
        .btn-shadow { background: var(--shadow-red); color: white; border: none; padding: 12px; width: 100%; cursor: pointer; font-weight: bold; text-transform: uppercase; }

        #modal-pago { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: #fff; padding: 30px; text-align: center; border-radius: 10px; color: #000; width: 340px; }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <h1 style="color:white; margin:0;">SHADOW <span style="color:var(--shadow-red)">EVENTS</span></h1>
        <button class="btn-shadow" style="width:auto; padding: 10px 20px;" onclick="toggleCart()">CARRITO (<span id="cart-count">0</span>)</button>
    </div>
    <div class="search-container">
        <input type="text" id="busNombre" placeholder="Buscar festival..." onkeyup="filtrar()">
    </div>
</header>

<div class="grid-eventos" id="grid"></div>

<div class="chat-container" id="chatBox">
    <div class="chat-header" onclick="toggleChat()"><span>ðŸ’¬ COMUNIDAD SHADOW</span><span>â–²</span></div>
    <div id="chat-display"></div>
    <div style="display:flex; padding:10px; background:#111;">
        <input type="text" id="cMsg" placeholder="Escribe..." style="flex:1; background:#000; color:white; border:1px solid #333; padding:5px;">
        <button onclick="enviarChat()" style="background:var(--shadow-red); color:white; border:none; padding:5px 10px;">></button>
    </div>
</div>

<div id="cart-sidebar">
    <h2 style="color:var(--shadow-red)">TU RESERVA</h2>
    <div id="cart-items" style="margin-bottom:20px;"></div>
    <h3 id="total-txt">Total: $0.00</h3>
    <input type="email" id="user-email" placeholder="Introduce tu correo" style="width:100%; padding:12px; margin-bottom:15px; background:#111; color:white; border:1px solid #444;">
    <button class="btn-shadow" onclick="abrirSeguridad()">CONFIRMAR Y ENVIAR</button>
</div>

<div id="modal-pago">
    <div class="modal-content" id="modal-dinamico"></div>
</div>

<script>
    emailjs.init("V_d4z6wljBT-pQmRG");

    const eventos = [
        { id: 1, n: "Defqon.1 Festival", p: 180, v: 5402, s: 120, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS8GvJIDyjmIPovEG2ebbvyVaEm4cKG2NeEzw&s", backImg: "https://images.steamusercontent.com/ugc/800990259998416749/3B7DA9DAB7A192F3D132FBDD4AA5C40B36B29095/?imw=512" },
        { id: 2, n: "Qlimax Ritual", p: 150, v: 3210, s: 45, img: "https://cdn.q-dance.com/l6hfsc63q612/2FRsiDag2QsEaYiaEAIG24/5796a2477e8078441e21e10147b0ae20/1508742861259_.jpg?w=720", backImg: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTMcHOq9gyYsbZAr_ketEPEdYWuviOQtaddcg&s" },
        { id: 3, n: "Masters of Hardcore", p: 130, v: 8740, s: 12, img: "https://i.scdn.co/image/ab67616d0000b2732ab0b1567475d90257920cd0", backImg: "https://images.steamusercontent.com/ugc/919169968638695501/2FBEF900D08E943CA0F739F79F2BC56F963EDF01/?imw=637" }
    ];

    let cart = [];
    let emailTemporal = "";

    function render(data = eventos) {
        document.getElementById("grid").innerHTML = data.map(ev => `
            <div class="ticket-container">
                <div class="ticket-3d">
                    <div class="front">
                        <div class="ticket-img" style="background-image:url('${ev.img}')"></div>
                        <div class="ticket-stats">
                            <span>VENDIDOS: ${ev.v}</span>
                            <span>DISPONIBLES: ${ev.s}</span>
                        </div>
                        <div style="padding:15px; text-align:center;">
                            <h3 style="color:white; margin:0;">${ev.n}</h3>
                            <b style="color:var(--shadow-red); font-size:22px;">$${ev.p}.00</b>
                        </div>
                    </div>
                    <div class="back">
                        <div class="back-img" style="background-image:url('${ev.backImg}')"></div>
                        <button class="btn-shadow" style="width:80%; margin:auto; display:block;" onclick="add(${ev.id})">AÃ‘ADIR</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function add(id) {
        cart.push(eventos.find(x => x.id === id));
        document.getElementById("cart-count").innerText = cart.length;
        updCart();
    }

    function updCart() {
        let t = 0;
        document.getElementById("cart-items").innerHTML = cart.map(i => { t += i.p; return `<div style="display:flex; justify-content:space-between; margin-top:8px;"><span>${i.n}</span><b>$${i.p}</b></div>`; }).join('');
        document.getElementById("total-txt").innerText = `Total: $${t.toFixed(2)}`;
    }

    function filtrar() {
        const busqueda = document.getElementById("busNombre").value.toLowerCase();
        const filtrados = eventos.filter(ev => ev.n.toLowerCase().includes(busqueda));
        render(filtrados);
    }

    function toggleCart() { document.getElementById("cart-sidebar").classList.toggle("active"); }
    function toggleChat() { document.getElementById("chatBox").classList.toggle("active"); }

    function enviarChat() {
        const m = document.getElementById("cMsg").value;
        if(m) { 
            document.getElementById("chat-display").innerHTML += `<div><b style="color:var(--shadow-red)">TÃº:</b> ${m}</div>`; 
            document.getElementById("cMsg").value = ""; 
            document.getElementById("chat-display").scrollTop = document.getElementById("chat-display").scrollHeight;
        }
    }

    function abrirSeguridad() {
        emailTemporal = document.getElementById("user-email").value;
        if(!emailTemporal.includes("@")) return alert("Ingresa un correo vÃ¡lido");
        
        const folio = "ORD-" + Math.floor(Math.random()*900000 + 100000);
        const total = document.getElementById("total-txt").innerText;

        document.getElementById("modal-dinamico").innerHTML = `
            <h3 style="margin:0;">AUTORIZACIÃ“N</h3>
            <div id="qrcode" style="display:flex; justify-content:center; margin:15px 0;"></div>
            <p style="font-size:14px;">Total Compra: <b>${total}</b></p>
            <p style="font-size:12px; color:gray;">Folio: ${folio}</p>
            <input type="password" id="pin-input" placeholder="PIN de Seguridad" style="width:100%; padding:12px; text-align:center; font-size:20px; border: 1px solid #ccc; border-radius:5px;">
            <button class="btn-shadow" style="margin-top:15px;" onclick="enviarFinal('${folio}', '${total}')">CONFIRMAR PAGO</button>
        `;
        document.getElementById("modal-pago").style.display = "flex";
        new QRCode(document.getElementById("qrcode"), { text: folio, width: 140, height: 140 });
    }

    function enviarFinal(folio, total) {
        if(document.getElementById("pin-input").value !== "666999") return alert("PIN Incorrecto");
        
        emailjs.send("service_5zmbkyl", "template_ocolova", {
            to_email: emailTemporal, 
            order_id: folio,
            cost: total
        }).then(() => {
            document.getElementById("modal-dinamico").innerHTML = `
                <h2 style="color:var(--verde);">Â¡PAGO EXITOSO!</h2>
                <p>Tu orden <b>${folio}</b> ha sido procesada.</p>
                <p>RecibirÃ¡s los boletos en: <br> ${emailTemporal}</p>
                <button class="btn-shadow" onclick="location.reload()">CERRAR</button>
            `;
        }, (err) => alert("Error: " + JSON.stringify(err)));
    }

    render();
</script>
</body>
</html>
